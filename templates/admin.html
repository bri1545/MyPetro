<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - Мой Петропавловск</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    {{template "header" .}}
    
    <main class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">Админ-панель</h1>
        
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-orange-600">На модерации ({{len .ModerationProjects}})</h2>
            {{if .ModerationProjects}}
                <div class="grid gap-4">
                    {{range .ModerationProjects}}
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-bold mb-2">{{.Title}}</h3>
                            <p class="text-gray-700 mb-4">{{.Description}}</p>
                            <div class="grid md:grid-cols-2 gap-4 text-sm mb-4">
                                <div><strong>Категория:</strong> {{.Category}}</div>
                                <div><strong>Район:</strong> {{.District}}</div>
                                <div><strong>Бюджет:</strong> {{.Budget}} ₸</div>
                                <div><strong>Голосов:</strong> {{.VoteCount}}</div>
                            </div>
                            
                            <form hx-post="/admin/update-status" hx-swap="none" class="space-y-4">
                                <input type="hidden" name="project_id" value="{{.ID}}">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Новый статус:</label>
                                    <select name="status" required class="w-full px-4 py-2 border rounded-lg" onchange="toggleDates(this, {{.ID}})">
                                        <option value="">Выберите статус</option>
                                        <option value="voting">Одобрить для голосования</option>
                                        <option value="rejected">Отклонить</option>
                                    </select>
                                </div>
                                
                                <div id="dates-{{.ID}}" class="hidden grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Начало голосования:</label>
                                        <input type="datetime-local" name="vote_start" class="w-full px-4 py-2 border rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Конец голосования:</label>
                                        <input type="datetime-local" name="vote_end" class="w-full px-4 py-2 border rounded-lg">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Комментарий:</label>
                                    <textarea name="comment" rows="3" class="w-full px-4 py-2 border rounded-lg" placeholder="Комментарий для автора"></textarea>
                                </div>
                                
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                    Обновить статус
                                </button>
                            </form>
                        </div>
                    {{end}}
                </div>
            {{else}}
                <p class="text-gray-600">Нет проектов на модерации</p>
            {{end}}
        </div>

        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-blue-600">На голосовании ({{len .VotingProjects}})</h2>
            {{if .VotingProjects}}
                <div class="grid gap-4">
                    {{range .VotingProjects}}
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-bold mb-2">{{.Title}}</h3>
                            <div class="text-sm mb-4">
                                <strong>Голосов:</strong> {{.VoteCount}} | <strong>Бюджет:</strong> {{.Budget}} ₸
                            </div>
                            
                            <form hx-post="/admin/update-status" hx-swap="none" class="space-y-4">
                                <input type="hidden" name="project_id" value="{{.ID}}">
                                <div class="flex gap-4">
                                    <button type="submit" name="status" value="selected" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                        ✓ Проект победил
                                    </button>
                                    <button type="submit" name="status" value="rejected" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                                        ✗ Отклонить
                                    </button>
                                </div>
                                <textarea name="comment" rows="2" class="w-full px-4 py-2 border rounded-lg" placeholder="Комментарий"></textarea>
                            </form>
                        </div>
                    {{end}}
                </div>
            {{else}}
                <p class="text-gray-600">Нет проектов на голосовании</p>
            {{end}}
        </div>

        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-green-600">Победители ({{len .SelectedProjects}})</h2>
            {{if .SelectedProjects}}
                <div class="grid gap-4">
                    {{range .SelectedProjects}}
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-bold mb-2">{{.Title}}</h3>
                            <div class="text-sm mb-4">
                                <strong>Голосов:</strong> {{.VoteCount}} | <strong>Бюджет:</strong> {{.Budget}} ₸
                            </div>
                            
                            <form hx-post="/admin/update-status" hx-swap="none" class="space-y-4">
                                <input type="hidden" name="project_id" value="{{.ID}}">
                                <button type="submit" name="status" value="in_progress" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700">
                                    Начать реализацию
                                </button>
                                <textarea name="comment" rows="2" class="w-full px-4 py-2 border rounded-lg" placeholder="Комментарий о начале работ"></textarea>
                            </form>
                        </div>
                    {{end}}
                </div>
            {{else}}
                <p class="text-gray-600">Нет победивших проектов</p>
            {{end}}
        </div>

        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-orange-600">В работе ({{len .InProgressProjects}})</h2>
            {{if .InProgressProjects}}
                <div class="grid gap-4">
                    {{range .InProgressProjects}}
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-bold mb-2">{{.Title}}</h3>
                            <div class="text-sm mb-4">
                                <strong>Бюджет:</strong> {{.Budget}} ₸
                            </div>
                            
                            <form hx-post="/admin/update-status" hx-swap="none" class="space-y-4">
                                <input type="hidden" name="project_id" value="{{.ID}}">
                                <button type="submit" name="status" value="done" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                    ✓ Проект завершен
                                </button>
                                <textarea name="comment" rows="2" class="w-full px-4 py-2 border rounded-lg" placeholder="Комментарий о завершении работ"></textarea>
                            </form>
                        </div>
                    {{end}}
                </div>
            {{else}}
                <p class="text-gray-600">Нет проектов в работе</p>
            {{end}}
        </div>

        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-600">Завершенные ({{len .DoneProjects}})</h2>
            {{if .DoneProjects}}
                <div class="grid gap-4">
                    {{range .DoneProjects}}
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-bold mb-2">{{.Title}}</h3>
                            <div class="text-sm">
                                <strong>Бюджет:</strong> {{.Budget}} ₸ | <strong>Голосов:</strong> {{.VoteCount}}
                            </div>
                        </div>
                    {{end}}
                </div>
            {{else}}
                <p class="text-gray-600">Нет завершенных проектов</p>
            {{end}}
        </div>
    </main>
    
    <script>
        function toggleDates(select, projectId) {
            const datesDiv = document.getElementById('dates-' + projectId);
            if (select.value === 'voting') {
                datesDiv.classList.remove('hidden');
            } else {
                datesDiv.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
